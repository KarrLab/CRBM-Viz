<biosimulations-text-page heading="Format for the execution status of a COMBINE/OMEX archive" [tocSections]="tocSections">
  <ng-container id="sideBar">
    <biosimulations-text-page-side-bar-section heading="Related resources" fxShow fxHide.lt-md>
      <div class="hanging-indent">
        <a [routerLink]="['/help']">
          <biosimulations-icon icon="tutorial"></biosimulations-icon>
          Tutorial
        </a>
      </div>
      <div class="hanging-indent">
        <a href="https://sed-ml.org/" target="_blank">
          <biosimulations-icon icon="tutorial"></biosimulations-icon>
          SED-ML documentation
        </a>
      </div>
    </biosimulations-text-page-side-bar-section>

    <biosimulations-text-page-help-side-bar-section fxShow fxHide.lt-md>
    </biosimulations-text-page-help-side-bar-section>

    <biosimulations-text-page-feedback-side-bar-section fxShow fxHide.lt-md>
    </biosimulations-text-page-feedback-side-bar-section>
  </ng-container>

  <ng-container id="content" tocSectionsContainer>
    <biosimulations-text-page-content-section
      heading="Overview"
      tocSection="Overview"
    >
      <p>This format enables simulation tools to consistently communicate information about the status of the executon of SED-ML files in COMBINE/OMEX archives. This includes the following information:</p>
      <ul class="vertically-spaced">
        <li><b>SED documents:</b> Which documents have been executed, which are currently executing, and which still remain to be executed.</li>
        <li><b>SED tasks:</b> Which tasks have been executed, which are currently executing, which are queued for execution, and which will be skippped, for example, because they require a feature of SED-ML such as <code>addXML</code> that the simulation tool does not support.</li>
        <li><b>SED reports and plots:</b> Which outputs have been completed, which are partially complete, and which cannot yet be started because none of the required data has been generated by the SED tasks.</li>
        <li><b>SED data sets, curve, and surfaces:</b> Which elements of reports and plots are available and which cannot yet be generated because they rely on tasks that have not yet completed.</li>
      </ul>
    </biosimulations-text-page-content-section>

    <biosimulations-text-page-content-section
      heading="Specifications"
      tocSection="Specifications"
    >
      <p>Simulators should encode the execution status of COMBINE/OMEX archives into YAML using the schema below.</p>

      <pre><code [languages]="['typescript']" highlight="interface CombineArchiveExecutionStatus {
  status: ExecutionStatus;
  sedDocuments: {[id: string]: SedDocumentExecutionStatus};
}

interface SedDocumentExecutionStatus {
  status: ExecutionStatus;
  tasks: {[id: string]: SedTaskExecutionStatus};
  outputs: {[id: string]: SedOutputExecutionStatus};
}

interface SedTaskExecutionStatus {
  status: ExecutionStatus;
}

interface SedOutputExecutionStatus {
  status: ExecutionStatus;
}

interface SedReportExecutionStatus extends SedOutputExecutionStatus {
  status: ExecutionStatus;
  dataSets: {[id: string]: ExecutionStatus};
}

interface SedPlot2DExecutionStatus extends SedOutputExecutionStatus {
  status: ExecutionStatus;
  curves: {[id: string]: ExecutionStatus};
}

interface SedPlot3DExecutionStatus extends SedOutputExecutionStatus {
  status: ExecutionStatus;
  surfaces: {[id: string]: ExecutionStatus};
}

enum ExecutionStatus {
  QUEUED = 'QUEUED',
  RUNNING = 'RUNNING',
  SUCCEEDED = 'SUCCEEDED',
  SKIPPED = 'SKIPPED',
  FAILED = 'FAILED',
}"></code></pre>
    </biosimulations-text-page-content-section>

    <biosimulations-text-page-content-section
      heading="Example status documents"
      tocSection="Example status documents"
    >
      <p>Below is an example of the initial status of a COMBINE/OMEX archive involving a single SED document with two tasks.</p>
      <pre><code [languages]="['yaml']" highlight="status: QUEUED
sedDocuments:
  doc_1.sedml:
    tasks:
      task_1_ss:
        status: QUEUED
      task_2_time_course:
        status: QUEUED
    outputs:
      report_1:
        status: QUEUED
        dataSets:
          dataset_1: QUEUED
          dataset_2: QUEUED
      report_2:
        status: QUEUED
        dataSets:
          dataset_3: QUEUED
          dataset_4: QUEUED
      report_3:
        status: QUEUED
        dataSets:
          dataset_5: QUEUED
      report_4:
        status: QUEUED
        dataSets:
          dataset_6: QUEUED"></code></pre>

          <p>Below is an example of the final status of the successful execution of the same COMBINE/OMEX archive.</p>
      <pre><code [languages]="['yaml']" highlight="status: SUCCEEDED
sedDocuments:
  doc_1.sedml:
    tasks:
      task_1_ss:
        status: SUCCEEDED
      task_2_time_course:
        status: SUCCEEDED
    outputs:
      report_1:
        status: SUCCEEDED
        dataSets:
          dataset_1: SUCCEEDED
          dataset_2: SUCCEEDED
      report_2:
        status: SUCCEEDED
        dataSets:
          dataset_3: SUCCEEDED
          dataset_4: SUCCEEDED
      report_3:
        status: SUCCEEDED
        dataSets:
          dataset_5: SUCCEEDED
      report_4:
        status: SUCCEEDED
        dataSets:
          dataset_6: SUCCEEDED"></code></pre>
    </biosimulations-text-page-content-section>

    <biosimulations-text-page-content-section
      heading="Events which should trigger simulators to update the status of COMBINE/OMEX archives"
      tocSection="Status update events"
    >
      <p>Simulation tools should update their status upon each of the following events:</p>

      <ul class="vertically-spaced">
        <li><b>Start of the execution of the COMBINE/OMEX archive.</b>. After this event, the status of the archive should be <code>RUNNING</code>, the status of each SED document and SED element that the simulation tool is capable of executing should be <code>QUEUED</code>, and the status of each SED document and SED element that the simulation tool is not capable fo executing should be <code>SKIPPED</code>.</li>
        <li><b>Start of the execution of each SED document.</b> This event should change the status of the document to <code>RUNNING</code>.</li>
        <li><b>Start of the execution of each SED task.</b> This event should change the status of the task to <code>RUNNING</code>.</li>
        <li><b>End of the execution of each SED task.</b> If the task succeeded, its status should be changed to <code>SUCCEEDED</code>. In addition, all data sets, curves, and surfaces which can now be generated should be generated, and their status should be changed to <code>SUCCEEDED</code>. The status of the parent reports and plots should be set to <code>SUCCEEDED</code> if all of their data sets, curves, and surfaces have been generated, or <code>RUNNING</code> if some of their data sets, curves, and surfaces cannot yet be generated because they depend on tasks which have not yet been executed. If the task failed, its status should be changed to <code>FAILED</code>, and the status of all data sets, curves, surfaces, reports, and plots which depend on the task should be changed to <code>FAILED</code>.</li>
        <li><b>End of the execution of each SED document.</b> If all of the task and outputs in the document succeeded, the document's status should be changed to <code>SUCCEEDED</code>. Otherwise, the document's status should be changed to <code>FAILED</code>.</li>
      </ul>

      <p>By the end of the execution of a COMBINE/OMEX archive, the status of all SED documents, tasks, reports, plots, data sets, curves, and surfaces should be one of <code>SUCCEEDED</code>, <code>SKIPPED</code>, or <code>FAILED</code>.</p>
    </biosimulations-text-page-content-section>
  </ng-container>
</biosimulations-text-page>

