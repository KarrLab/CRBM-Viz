<biosimulations-page heading="Validate a simulation project">
  <form [formGroup]="formGroup" (ngSubmit)="onFormSubmit()">
    <div class="form-section">
      <div class="form-section-head">
        <div class="mat-form-field-prefix">
          <biosimulations-icon icon="project"></biosimulations-icon>
        </div>
        <div class="form-section-head-title-subtitle">
          <div class="form-section-title">SED-ML and associated files*</div>
          <div class="form-section-subtitle">
            Select a local file or enter a URL for a COMBINE/OMEX or zip archive that
            contains SED-ML files and associated model and metadata files
          </div>
        </div>
      </div>
      <div class="form-section-body">
        <div class="form-field-group">
          <div class="columns two-columns">
            <mat-form-field appearance="fill">
              <biosimulations-icon
                icon="location"
                matPrefix
              ></biosimulations-icon>
              <mat-label
                >Select a method for providing a simulation project
                (COMBINE/OMEX or zip archive file)</mat-label
              >
              <mat-select
                required
                formControlName="submitMethod"
                (ngModelChange)="changeSubmitMethod()"
              >
                <mat-option value="file">Upload a local file</mat-option>
                <mat-option value="url">Enter a URL for a file</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field
              appearance="fill"
              *ngIf="formGroup.value.submitMethod === 'file'"
            >
              <biosimulations-icon
                icon="project"
                matPrefix
              ></biosimulations-icon>
              <mat-label
                >Select a simulation project (COMBINE/OMEX or zip archive file)</mat-label
              >
              <ngx-mat-file-input
                formControlName="projectFile"
                accept=".omex,.sedx,.zip,application/zip"
                [multiple]="false"
                [required]="true"
              ></ngx-mat-file-input>
            </mat-form-field>

            <mat-form-field
              appearance="fill"
              *ngIf="formGroup.value.submitMethod === 'url'"
            >
              <biosimulations-icon icon="url" matPrefix></biosimulations-icon>
              <mat-label>Enter a URL for a COMBINE/OMEX or zip archive</mat-label>
              <input
                [required]="true"
                matInput
                formControlName="projectUrl"
                [placeholder]="exampleCombineArchiveUrl"
              />
            </mat-form-field>
          </div>

          <mat-hint>
            <p>
              Select a method for providing a COMBINE/OMEX or zip archive which
              describes one or more simulations (in SED-ML format) of one or
              more models (e.g., in BNGL, SBML formats). Archives can
              either be uploaded from your local computer or loaded from a
              publicly-accessible URL.
            </p>

            <p>
              Several example simulation projects are available from the
              BioSimulators test suite
              <a [href]="exampleCombineArchivesUrl" target="_blank"
                ><biosimulations-icon icon="link"></biosimulations-icon></a
              >.
            </p>
          </mat-hint>
          <mat-error
            *ngIf="
              (submitPushed || projectFileControl.touched) &&
              formGroup.hasError('required', 'projectFile')
            "
            >Please select a COMBINE/OMEX or zip archive file.</mat-error
          >
          <mat-error
            *ngIf="
              (submitPushed || projectFileControl.touched) &&
              formGroup.hasError('maxSize', 'projectFile')
            "
            >Currently, archives are limited to 16 MB.</mat-error
          >
          <mat-error
            *ngIf="
              (submitPushed || projectUrlControl.touched) &&
              formGroup.hasError('url', 'projectUrl')
            "
            >Please enter a URL for a COMBINE/OMEX or zip file.</mat-error
          >
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-section-head">
        <div class="mat-form-field-prefix">
          <biosimulations-icon icon="project"></biosimulations-icon>
        </div>
        <div class="form-section-head-title-subtitle">
          <div class="form-section-title">Options</div>
          <div class="form-section-subtitle">
            Optionally, disable validation of aspects of simulation project archives.
          </div>
        </div>
      </div>
      <div class="form-section-body">
        <div class="form-field-group options">
          <div>
            <mat-checkbox
              formControlName="validateOmexManifest"
              >
              Validate the OMEX manifest <a href="https://combinearchive.org/" target="_blank"><biosimulations-icon icon="link"></biosimulations-icon></a> file in the archive.
            </mat-checkbox>
          </div>
          <div>
            <mat-checkbox
              formControlName="validateSedml"
              >
              Validate the SED-ML <a href="https://sed-ml.org/" target="_blank"><biosimulations-icon icon="link"></biosimulations-icon></a> files in the archive.
            </mat-checkbox>
          </div>
          <div>
            <mat-checkbox
              formControlName="validateSedmlModels"
              >
              Validate the sources of the models (e.g., CellML <a href="https://www.cellml.org/" target="_blank"><biosimulations-icon icon="link"></biosimulations-icon></a>, SBML <a href="http://sbml.org/" target="_blank"><biosimulations-icon icon="link"></biosimulations-icon></a> files) in the SED-ML files in the archive.
            </mat-checkbox>
          </div>
          <div>
            <mat-checkbox
              formControlName="validateOmexMetadata"
              >
              Validate the OMEX Metadata <a href="https://sys-bio.github.io/libOmexMeta/docs-build/index.html" target="_blank"><biosimulations-icon icon="link"></biosimulations-icon></a> files in the archive.
            </mat-checkbox>
          </div>
          <div>
            <mat-checkbox
              formControlName="validateImages"
              >
              Validate the image (BMP, GIF, JPEG, PNG, TIFF, WEBP) files in the archive.
            </mat-checkbox>
          </div>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button mat-flat-button type="submit" class="biosimulations-button text">
        Validate
      </button>
    </div>

    <div class="status-summary" *ngIf="status !== undefined">
      <div class="valid" *ngIf="status === 'valid'">
        The aspects of your simulation project that you chose to validate are likely valid!
      </div>
      <div class="errors" *ngIf="status === 'invalid'">
        Your simulation project is invalid.
      </div>
      <div class="warnings" *ngIf="status === 'warnings'">
        Your simulation project may be invalid.
      </div>
    </div>

    <div
      class="validation-report"
      *ngIf="status === 'invalid' || status === 'warnings'"
    >
      <div class="validation-report-section errors" *ngIf="errors">
        Errors:
        <ul [innerHTML]="errors"></ul>
      </div>

      <div class="validation-report-section warnings" *ngIf="warnings">
        Warnings:
        <ul [innerHTML]="warnings"></ul>
      </div>
    </div>
  </form>
</biosimulations-page>
